# Empezamos tema 3

Objetivos
- Persistencia
- Compartición: NFS (no ofrece altas prestaciones), Ceph
- Prestaciones
- Alta Disponibilidad (tolerancia a fallos)
	- Solo lecturas
	- Lecturas/Escituras

Tipos almacenamientos basicos
- Almacenes de objetos (S3 de amazon)
	- Como un sistema de ficheros pero sin directorios
	- Solo hay ficheros denominados objetos
- Almacenes de bloques
	- Manejar particiones, discos, y volumenes logicos
- Sistemas de ficheros: ext4, ntfs (los de windows), NFS, CIFS
	- organización jerárquica de ficheros

![[Pasted image 20250213161810.png]]

RAID 0
- Coger los datos y partirlo en varios discos
- mejora en prestaciones duplicando velocidad de acceso
RAID 1
- tolerancia a fallos
RAID 5
- combinacion de prestaciones(stripping, repartir en diferentes discos) y fiabillidad(corrección de errores como puntos de paridad)

Particiones
- definir discos contiguos
- implicaciones en administracion a la hora de reorganizar el espacio

Volumenes logicos
- facilito el uso de particiones fisicas
- mas libertad a la hora de definir espacio en disco
	- aumentar a mas del tamaño del disco

Dispositivos bloques
- sobre estos se construyen los sistemas de ficheros

Aspectos relevantes
- Separación de datos y metadatos
- Fallos
- Ocupación de espacio
	- Preveer el reorganizamiento (modificarlos, comprar mas discos, etc)
- Prestaciones
- Arquitectura de nodos
- Arquitectura de red

Tareas:
- Definición del modelo de uso
	- Al insertar un nodo que se haga automatizado
		- Por ahora lo haremos manualmente
- Balanceo de datos entre nodos
	-  Una tarjeta de red para balanceo
		- Que tenga buen ancho de banda
-  Monitorizacion
	- Fallos, capacidad, prestaciones

## Almacenamiento integrado local: ZFS
Sistemas de ficheros tradicionales:
- gestion segmentada de almacenamiento
	- Separan en tres niveles
		- fisico
		- logico
		- sistemas de ficheros
		- Los tres niveles son diferentes y cada uno esta gestionado por su sistema interno
- Preservacion de  consistencia mediante tecnicas de "journaling"
	- permite a recuperacion a estados previos consistentes del sist ficheros
- ejemplos: ext4 y xfs (Linux) , UFS2 (OpenBSD y FreeBSD), NTFS (Windows)

ZFS:
- Sistema por defecto en FreeBSD y TrueNAS (Network Attached Storage)
- Gestor de volumenes logicos y RAID
	- necesario deshabilitar funcionalidad hardware RAID para un comportamiento adecuado
- Consistencia en todos los niveles de la problematica de almacenamiento
	- Único opcional a nivel de RAM
	- RAMFC: ram que incluye deteccion de errores 
- Detección de errores reforzada mediante uso sistemático de checksums
- Se pueden añadir discos como en gestión de volumenes lógicos
- RAID-Z: mirar de alguna forma en casa


![[Pasted image 20250213164850.png]]

Funcionalidades basicas: Storage pools y DataSets
- Similar a las nociones de “grupo volumen” y “Sistema de ficheros”
- Storage Pool compuesto por “virtual devices”: discos, particiones, dispositivos SAN (Storage Area Network), grupos “mirror”, RAID,
- Virtual devices compuestos por dispositivos reales (discos, SSDs, hardware RAIDs,..)

Comandos basicos:
- zpool: crear y gestionar “storage pools”
- zfs : crear entidades de almacenamiento sobre “pool”: DataSets Sist. Fich.) almacenamiento para bases de datos, volumenes lógicos (area swapping), respaldo para volumenes de SAN
- zfs send: te lo manda a salida estandar con una tuberia o algo a donde envie
	- se puede hacer en remoto
	- se hace en snapshots
- https://www.zfshandbook.com/docs/references/cheatsheet/

COW: copy on write
- amplia, no modifica

Sistemas ficheros jerárquicos:
- Creación: sudo zfs create demo/new_fs
- Listar: zfs -r demo -> -r recursivo de pradres a hijos
- Propiedades asignables:
	- Reserva y quota: emulan sist ficheros tradicionales
	- Limites para frupo de sist ficheros
	- herencia de propiedades de sist ficheros padre a sist ficheros hijos
		- listar propiedades: zfs get all demo/new_fs
- Ventajas con un SF por usuario : quotas, snapshots, delegación servicios

zh root
- coger un directorio y convertirlo en el raiz
- ya no ves nada más del sistema o del sistema de ficheros

Gestion de "storage pools":
- zroot: pool que contiene el Sist ficheros de arranque
	- solo puede utilizar morro a un disco
- Multiples configuraciones RAID en un mismo pool
- Posibilidad de utilizar SSDs como caches de lectura.
- Posibilidad de utilizar disco de repuesto (spare) asociado a varios pools
	- Primer pool que detecta fallo de uno de sus disco, lo reclama y utiliza


NFS (Network file system) y CIFS (Common Internet File System):
- montado automatico: automont
	- sistema de ficheros remoto se monta en un directorio cuando se hace cd
	- montaje dinamico respecto a cd
- vertiente servidor
- vertiente cliente
- hendrix -> usar nfs como home
- escritura de red a un solo servidor

Funcionalidades basicas como SFs
- Operaciones de montaje, demontaje, lectura, escritura, bloqueos en escritura concurrente sobre datos que se encuentran en otras máquinas
- Problématica importante de fallos de comunicación (red, servidor, cliente)
- Estado
	- Sin : solo se validan escrituras cuando ya se han efectuado en disco remoto
		- Más simple para tolerancia fallos
	- Con (cacheado) : gestión de ficheros abiertos y escrituras en báferes
		- Mayores prestaciones
		- Problemática más compleja de fallos
- Seguridad:
	- El problema de control de accesos a ficheros se traslada a la red (cuentas de usuario, permisos,..), necesitando añadir el concepto de privilegio de accesos a máquinas.
	- Se añaden sistemas de control de accesos centralizados (tema siguiente) para ayudar

