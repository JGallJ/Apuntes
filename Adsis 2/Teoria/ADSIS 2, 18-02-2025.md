## Network File system Protocol (NFS)

OpenBSD: solo version 3
Versión 3 y 4 : Linux y FreeBSD

![[Pasted image 20250218170906.png]]

Todo servidor Windows tiene integrado Kerberos desde hace tiempo

Listas de control de acceso para determinar permisos (ACLs)
- Definimos los tres tipos de acceso básicos: r w e
- Puedes definir para cada usuario un grupo

NFS pretende ser un protocolo independiente de seguridad, pero los servidores NFS implementan, al menos, las siguientes opciones
- AUTH_ NONE: sin autentificacion
- AUTH_SYS: Control accesos con usuarios-grupos estilo UNIX
- RPCSEC_GSS: Autentificación, Integridad, Privacidad (Kerberos)

### Servidor NFS versión 4
Componentes:
- Implementación servidor nfs en núcleo
- Correspondencias de puertos RPC (portmap)
- Ficheros de soporte común al cliente y al servidor

Etapas Linux:
- Configuración portmap (demonio)
	- /etc/default/portmap
- Configuración idmapd
	- /etc/default/nfs-common -> NEED_IDMAP=YES
	- /etc/idemapd.comnf
		- Domain = localdomain

Configurarción basica del servidor /etc/exports
- Creación de un pseudo sistema de ficheros a exportar. Ejemplo: 

![[Pasted image 20250218172817.png]]

a quien le quieres permitir mediante IPs y que permisos le vas a dar
- /exports le permitimos que lo monten usuarios que esten en la subred *tal* 
	- entre paréntesis lo que le permitimos al usuario
		- rw son los permisos
		- no_root_squash no tumbas a los qe quieran conectarse con root
		- 
		- fsid=0 cual es el identificador del sistema de ficheros

En freeBSD
- No define pseudo SF, como define el standard NFSv4, pero si un directorio raíz de referencia en /etc/exports (man nfsv4), además de los directorios a exportar, bajo ese directorio raíz :
![[Pasted image 20250218173538.png]]

### Cliente NFS
Gestionar el montaje de los SFs remotos (mount y sus extensiones NFS)
- mount puede establecer montajes temporales, pero para montajes permanentes utilizar el montaje automático (automount o amd) o el fichero /etc/fstab con entradas del tipo :
![[Pasted image 20250218173921.png]]
- Y la ejecución de : mount -a -t nfs4 (Linux)

no hace falta identificación de usuario, sino de maquinas
re arranque de servicios no es lo mejor a nivel de administración 

problema en red: sistema de ficheros se queda en ***d*** , necesitando un rearranque entero o igual significa que se ha cascado si este es local y no distribuido
- Si es distribuido es más normal

En algunos sistemas, posibilidad de incluir el demonio (biod, nfsiod, ...) para incrementar las prestaciones de E/S
- Realizar labores de caching
- Se puede ejecutar varias copias de este demonio para optimizar prestaciones

hay forma de poner en un pc solo CPU y RAM, el sistema de ficheros esta fuera y no en la propia máquina

Usuario en cliente deberia ser igual a usuario en servidor

#### Montadores automáticos
El montaje se produce en el momento que quieras acceder y mientras sigas usándolo permanece, pero si no estas usándolo por un tiempo se desmonta 
- Quien monta, con que monta y de que forma monta

Montadores automáticos metidos con calzador en freeBSD y linux